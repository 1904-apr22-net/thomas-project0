CREATE DATABASE Project0;

GO
CREATE SCHEMA Cigar;
GO

CREATE TABLE Cigar.Cigar(
	Id INT NOT NULL IDENTITY,
	Name NVARCHAR(200) NOT NULL,
	DateModified DATETIME2 NOT NULL DEFAULT(GETDATE()),
	Active BIT NOT NULL DEFAULT(1),
	CONSTRAINT PK_CigarId PRIMARY KEY (Id),
	--CONSTRAINT U_Name_ManufacturerId UNIQUE (Name, ManufacturerId)
	);

CREATE TABLE Cigar.Manufacturer(
	Id INT NOT NULL IDENTITY,
	Name NVARCHAR(200) NOT NULL,
	DateModified DATETIME2 NOT NULL DEFAULT(GETDATE()),
	Active BIT NOT NULL DEFAULT(1),
	CONSTRAINT PK_ManufacturerId PRIMARY KEY (Id),
	);

ALTER TABLE Cigar.Cigar ADD
	ManufacturerId INT NOT NULL DEFAULT(1),
	CONSTRAINT FK_Cigar_Manufacturer FOREIGN KEY (ManufacturerId) REFERENCES Cigar.Manufacturer (Id);

ALTER TABLE Cigar.Manufacturer ADD
	Location NVARCHAR(100) NOT NULL DEFAULT('unknown');

SELECT *
FROM Cigar.Cigar

CREATE TABLE Cigar.CigarBodyChar(
	Id INT NOT NULL IDENTITY,
	Body NVARCHAR(200) NOT NULL,
	DateModified DATETIME2 NOT NULL DEFAULT(GETDATE()),
	Active BIT NOT NULL DEFAULT(1),
	CONSTRAINT PK_CigarBodyChar PRIMARY KEY (Id),
	);

ALTER TABLE Cigar.Cigar ADD
	BodyId INT NOT NULL DEFAULT(0),
	CONSTRAINT FK_Cigar_CigarBodyChar FOREIGN KEY (BodyId) REFERENCES Cigar.CigarBodyChar (Id);

GO
CREATE TRIGGER Cigar.MovieDateModified ON Cigar.Cigar
AFTER UPDATE
AS
BEGIN
	UPDATE Cigar.Cigar
	SET DateModified = GETDATE()
	WHERE Id IN (SELECT Id FROM Inserted);
END

CREATE TABLE Cigar.Customer(
	Id INT NOT NULL IDENTITY,
	FirstName NVARCHAR(200) NOT NULL,
	LastName NVARCHAR(200) NOT NULL,
	Address1 NVARCHAR(200) NOT NULL,
	Address2 NVARCHAR(200) NOT NULL,
	City NVARCHAR(200) NOT NULL,
	State NVARCHAR(200) NOT NULL,
	ZipCode NVARCHAR(200) NOT NULL,
	DefaultStore NVARCHAR(200) NOT NULL,
	DateModified DATETIME2 NOT NULL DEFAULT(GETDATE()),
	Active BIT NOT NULL DEFAULT(1),
	CONSTRAINT PK_Customer PRIMARY KEY (Id),
	);

CREATE TABLE Cigar.Store(
	Id INT NOT NULL IDENTITY,
	Address1 NVARCHAR(200) NOT NULL,
	Address2 NVARCHAR(200) NOT NULL,
	City NVARCHAR(200) NOT NULL,
	State NVARCHAR(200) NOT NULL,
	ZipCode NVARCHAR(200) NOT NULL,
	DateModified DATETIME2 NOT NULL DEFAULT(GETDATE()),
	Active BIT NOT NULL DEFAULT(1),
	CONSTRAINT PK_Store PRIMARY KEY (Id),
	);
CREATE TABLE Cigar.Orders(
	Id INT NOT NULL IDENTITY,
	OrderTotal MONEY NOT NULL DEFAULT(0),
	DatePlaced DATETIME2 NOT NULL DEFAULT (GETDATE()),
	DateModified DATETIME2 NOT NULL DEFAULT(GETDATE()),
	Active BIT NOT NULL DEFAULT(1),
	CONSTRAINT PK_Orders PRIMARY KEY (Id),
	);

ALTER TABLE Cigar.Orders ADD
	CustomerId INT NOT NULL DEFAULT(0),
	CONSTRAINT FK_Orders_Customer FOREIGN KEY (CustomerId) REFERENCES Cigar.Customer (Id);


ALTER TABLE Cigar.Customer ADD
	DefaultStoreId INT NOT NULL DEFAULT(0),
	CONSTRAINT FK_Customer_Store FOREIGN KEY (DefaultStoreId) REFERENCES Cigar.Store (Id);

